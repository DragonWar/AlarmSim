<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="pingback" href="http://blog.perquin.com/xmlrpc.php">

	<title>  ODB II » Tech Toy Hacks</title>
<link rel="alternate" type="application/rss+xml" title="Tech Toy Hacks » Feed" href="http://blog.perquin.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Tech Toy Hacks » Comments Feed" href="http://blog.perquin.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Tech Toy Hacks » ODB II Category Feed" href="http://blog.perquin.com/blog/category/odbii/feed/">
<link rel="stylesheet" id="cptchStylesheet-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="suffusion-theme-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/style_002.css" type="text/css" media="all">
<link rel="stylesheet" id="suffusion-theme-skin-1-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/skin.css" type="text/css" media="all">
<!--[if !IE]>--><link rel="stylesheet" id="suffusion-rounded-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/rounded-corners.css" type="text/css" media="all">
<!--<![endif]-->
<!--[if lt IE 8]><link rel='stylesheet' id='suffusion-ie-css'  href='http://blog.perquin.com/wp-content/themes/suffusion/ie-fix.css?ver=3.7.8' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="suffusion-generated-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/a.css" type="text/css" media="all">
<link rel="stylesheet" id="counterize_stylesheet-css" href="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/counterize.css" type="text/css" media="all">
<script type="text/javascript" src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/jquery.js"></script>
<script type="text/javascript" src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/suffusion.js"></script>
<script type="text/javascript" src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/counterize.php"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.perquin.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.perquin.com/wp-includes/wlwmanifest.xml"> 
<!-- Start Additional Feeds -->
<!-- End Additional Feeds -->
<!--[if lt IE 7]>
<script src="http://blog.perquin.com/wp-content/themes/suffusion/belatedpng.js"></script>
<script>
	//Drew Diller's Belated PNG: http://dillerdesign.wordpress.com/2009/07/02/belatedpng-img-nodes-javascript-event-handling/
  	DD_belatedPNG.fix('img, .suf-widget ul li, #sidebar ul li, #sidebar-2 ul li, .sidebar-tab-content ul li, li.suf-mag-catblock-post, input, .searchform .searchsubmit, #right-header-widgets .searchsubmit, #left-header-widgets .searchsubmit, #top-bar-left-widgets .searchsubmit,  #top-bar-right-widgets .searchsubmit, submit, .searchsubmit, .postdata .category, .postdata .comments, .postdata .edit, .previous-entries a, .next-entries a, .post-nav .next a, .post-nav .previous a, .post .date, h3#comments, h3.comments, #h3#respond, h3.respond, blockquote, blockquote div');
 </script>
<![endif]-->
</head>
<body class="archive category category-odbii category-4">
        <script type="text/javascript">
        //Menu effects
        var suf_nav_delay = 500;
        var suf_nav_effect = "fade";
        var suf_navt_delay = 500;
        var suf_navt_effect = "fade";
        var suf_jq_masonry_enabled = "disabled";
    </script>
				<div id="wrapper" class="fix">
					<div id="header-container" class="fix">
					<div id="header" class="fix">
			<h1 class="blogtitle"><a href="http://blog.perquin.com/">Tech Toy Hacks</a></h1>
		<div class="description">A loose collection of hardware/software projects.</div>
    </div><!-- /header -->
 	<div id="nav" class="tab fix">
		<div class="col-control">
		<!-- right-header-widgets -->
		<div id="right-header-widgets" class="warea">
		
<form method="get" class="searchform" action="http://blog.perquin.com/">
	<input value="Search" name="s" class="searchfield" onfocus="if (this.value == 'Search') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search';}" type="text">
	<input class="searchsubmit" value="" name="searchsubmit" type="submit">
</form>
		</div>
		<!-- /right-header-widgets -->
		</div><!-- /col-control -->
	</div><!-- /nav -->
			</div><!-- //#header-container -->
			<div id="container" class="fix">
				
    <div id="main-col">
      <div id="content" class="hfeed">
	<div class="post-13 post type-post status-publish format-standard hentry category-odbii" id="post-13">
		<div class="title-container fix">
			<div class="title">
							<h2 class="posttitle"><a href="http://blog.perquin.com/blog/obd-ii/" class="entry-title" rel="bookmark" title="OBD-II">OBD-II</a></h2>
				<div class="postdata fix">
					<span class="category"><a href="http://blog.perquin.com/blog/category/odbii/" title="View all posts in ODB II" rel="category tag">ODB II</a></span>
			<span class="comments"><a href="http://blog.perquin.com/blog/obd-ii/#comments" title="Comment on OBD-II">1 Response »</a></span>
				</div><!-- /.postdata -->
			</div><!-- /.title -->
			<div class="date"><span class="month">Oct</span> <span class="day">27</span><span class="year">2004</span></div>
		</div><!-- /.title-container -->
	<div class="entry-container fix">
		<div class="entry entry-content fix">
<div>OBD is a diagnostic interface a found on many build in 1996 or later. A description of the OBD protocol can be found <a href="#protocol">below</a>.</div>
<h2>RS-232 Serial Cable</h2>
<div>The interface depicted below can be used build a serial cable to 
connect the serial port of the computer to the 16-pin OBD-II connecter 
found in many cars build in 1996 or later. This interface only supports 
the ISO 9141-2 / ISO 14230-2 K-line tranfer mode. If in your ODB 
connecter pin 7 (K-Line) is present and pin 15 (L-Line) is missing then 
this interface will most likely work for your vehicle.</div>
<div>The interface has been tested to work with GPL Linux scantool program <a href="http://sourceforge.net/projects/freediag/">freediag</a>. A pre-compiled version can be downloaded <a href="http://blog.perquin.com/prj/odbii/scantool.tar.gz">here</a>.</div>
<div><img src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/obdii_rs232.gif" alt=""></div>
<div><img src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/obd_connector.gif" alt=""><br>
OBD-II 16 Pin Connector</div>
<div><strong>Alternative ISO interface design:</strong> <a href="http://www.planetfall.com/%7Ejeff/obdii/schematic_b1.pdf">Opto-Coupler Schematic PDF</a> | <a href="http://www.planetfall.com/%7Ejeff/obdii/">Jeff Noxon Website</a></div>
<div></div>
<hr>
<h2>OBD-Microcontroller Interface</h2>
<div>This interface can be used to connect a microcontroller (AVR ATMega8 for example) to the OBD connecter in your car.</div>
<div><img src="ODB%20II%20%C2%BB%20Tech%20Toy%20Hacks_files/obdii_avr.gif" alt=""></div>
<hr>
<p><a name="protocol"></a></p>
<pre><h1>OBD-II ISO 14230-2 Protocol Specification</h1>
This document describes the OBD-II ISO 14230-2 serial interface protocol. It has been compiled from
various public internet sources. I have been successful building an ODB interface with this information,
but no guarantee can be given that this information is correct. Use at your own risk.
<h2>Timing</h2>
(in ms)
0-20	Inter byte timing in ECU response
25-50	Time between end of tester request and start of ECU response or between ECU responses
25-5000	Extended mode for "rspPending"
55-5000	Time between end of ECU response and start of new tester request, or time between end of tester
request and start of new request if ECU doesn't respond */
5-20	Inter byte time in tester request
<h2>Initialization</h2>
<strong>Fastinit:</strong>
_________       _____        ____        ____
         \_____/     \/\/\/\/    \/\/\/\/
 300ms    25ms  25ms  packet     response 

1) Wait for 300ms with K line high.
2) Pull K line low for 25 +/- 1 ms
3) Let K line rise high and wait 25ms
4) init serial connection to 10400 baud, 8N1, 1=0Volt 0=12Volt, least significant bit first
5) send package c1 33 f1 81 66    33=dest, f1=our tester id, 81=start comms
6) wait for response 83 f1 01 c1 e9 8f ae   01=physical address, c1=response ok (7f=fail), e9=kb1, 8f=kb2

<strong>Slowinit:</strong>

_________ S ___ 2 3 ___ 6 7 ___        ____        ____
         \_/0 1\___/4 5\___/P  \/\/\/\/    \/\/\/\/
 300ms  200 400 400 400 400 250 packet     response 

1) Wait for 300ms with K line high.
2) send a byte 33 hex at 5 baud. 200ms per bit
     startbit:      200ms low
     databit0,1:    400ms high
     databit2,3:    400ms low
     databit4,5:    400ms high
     databit6,7:    400ms low
     stopbit+pause: 250ms high
4) init serial connection to 10400 baud, 8N1, 1=0Volt 0=12Volt, least significant bit first
5) send package c1 33 f1 81 66    33=dest, f1=our tester id, 81=start comms
6) wait for response 83 f1 01 c1 e9 8f ae   01=physical address, c1=response ok (7f=fail), e9=kb1, 8f=kb2
<h2>Packets</h2>
Send command packet:
header: [c0+cmdlen] [destination=33] [source=f1]
data: [cmd0] [cmd1] ... [cmd(cmdlen-1)]
checksum: [sum(header)+sum(data)]

cmd0 = service ID
cmd1 = PID

Received response packet on success:
header: [80+datalen] [destination=f1] [source=01]
data: [40+cmd0] [cmd1] ... [cmd(cmdlen-1)] [result0] [result1] ... [result(datalen-cmdlen-1)]
checksum: [sum(header)+sum(data)]

Received response packet on failure:
header: [80+datalen] [destination=f1] [source=01]
data: [errorcode=7f] [cmd0] [Response Failure Code, see below]
checksum: [sum(header)+sum(data)]

Multibyte data is sent high byte first.
<h2>Tester Commands</h2>
request and response packet diagram format:
cmd0 cmd1 ... -&gt; result0 result1 ...   comment
Note: only the data of the request and only the result of the response are show.

yy 00 -&gt; xx xx xx xx   bitmask of capabilities for mode yy, bit7 represents pid 1, bit6 pid 2, etc, if
data4:bit0 is set then pid 20 contains capabilities for pid 21-40

<strong>00-0F: SAE J1979 Diagnostic Test Modes</strong>
01 00 -&gt; xx xx xx xx capabilites
01 01 -&gt; [b7: MIL light, b0-6: dtc count] [b4-7: readiness] [b5: o2monitoring] [b0-7: readiness]
01 03 -&gt; xx xx  Fuel System Status		bitmap 	b0:Open, b1:Closed, b2:Open-Driving, b3:Open-Fault, b4:Closed-Fault
01 04 -&gt; xx     Calculated Load Value		%	x*100.0/255
01 05 -&gt; xx     Engine Coolant Temperature	C	x-40
01 06 -&gt; xx     Short term fuel trim Bank 1	%	x*(100.0/128)-100
01 07 -&gt; xx     Long  term fuel trim Bank 1	%	x*(100.0/128)-100
01 08 -&gt;        Short term fuel trim Bank 2	%	x*(100.0/128)-100
01 09 -&gt;        Long  term fuel trim Bank 2	%	x*(100.0/128)-100
01 0a -&gt;        Fuel Pressure			kPaG	x*3
01 0b -&gt; xx     Intake Manifold Pressure	kPaA	x
01 0c -&gt; xx xx  Engine RPM			RPM	x*0.25
01 0d -&gt; xx     Vehicle Speed			km/h	x
01 0e -&gt; xx     Ignition timing advance Cyl #1	deg	X*0.5-64
01 0f -&gt; xx     Intake Air Temperature		C	X-40
01 10 -&gt; xx xx  Air Flow Rate			gm/s	X*0.01
01 11 -&gt; xx     Absolute Throttle Position	%	X*(100.0/255)
01 12 -&gt; xx     Commanded secondary air status
01 13 -&gt; xx     Oxygen sensor locations		bitmap	b0=sensor1, b1=sensor2, ..., b7=sensor8
01 14 -&gt; xx yy  Bank 1 Sensor 1 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 15 -&gt; xx yy  Bank 1 Sensor 2 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 16 -&gt;        Bank 1 Sensor 3 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 17 -&gt;        Bank 1 Sensor 4 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 18 -&gt;        Bank 2 Sensor 1 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 19 -&gt;        Bank 2 Sensor 2 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 1a -&gt;        Bank 2 Sensor 3 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 1b -&gt;        Bank 2 Sensor 4 Voltage/Trim	V, %	x*0.005, if y!=ff then y*(100.0/128)-100)
01 1c -&gt; xx     Auxiliary Input Status		bitmap	b0:PTO Active
01 20 -&gt; xx xx xx xx capabilities
01 21 -&gt; xx xx

02 00 00 -&gt; xx xx xx xx capabilites SMART: 2 3 4 5 6 7 b c d
02 02 00 -&gt; [dtc1h] [dtc1l]         DTC that caused freezeframe

03 -&gt; [dtc1h] [dtc1l] 00 00 00 00

05 00 00 -&gt; xx xx xx xx capabilites

06 00 -&gt; xx xx xx xx capabilites

06 yy -&gt; [max=01,min=81] [valH] [valL] [limitH] [limitL]  example 01 00 23 01 2c is value 23 (=35 dec)
with limit maximum 12c (=300 dec)

06 01 -&gt; xx xx xx xx xx   ncms
06 02 -&gt; xx xx xx xx xx   ncms
06 09 -&gt; 01 xx xx xx xx -&gt; 81 xx xx xx xx  ncms

07 -&gt; 00 00 00 00 00 00   cms

08 00 00 00 00 00 00 -&gt; xx xx xx xx capabilites SMART: none

09 00 -&gt; 01 30 00 00 00   capabilites  5 bytes??? 

10	Start Diagnostic Session
11	ECU Reset
12	Read Freeze Frame Data
13	Read Diagnostic Trouble Codes
14	Clear Diagnostic Information
17	Read Status Of Diagnostic Trouble Codes
18	Read Diagnostic Trouble Codes By Status
1A	Read Ecu Id
20	Stop Diagnostic Session
21	Read Data By Local Id
22	Read Data By Common Id
23	Read Memory By Address
25	Stop Repeated Data Transmission
26	Set Data Rates
27	Security Access
2C	Dynamically Define Local Id
2E	Write Data By Common Id
2F	Input Output Control By Common Id
30	Input Output Control By Local Id
31	Start Routine By Local ID
32	Stop Routine By Local ID
33	Request Routine Results By Local Id
34	Request Download
35	Request Upload
36	Transfer data
37	Request transfer exit
38	Start Routine By Address
39	Stop Routine By Address
3A	Request Routine Results By Address
3B	Write Data By Local Id
3D	Write Memory By Address
3E	Tester Present
81 -&gt; xx xx	Start Communication
82	Stop Communication
83	Access Timing Parameters
85	Start Programming Mode
<h2>Response Failure Codes</h2>
10	General Reject
11	Service Not Supported
12	Sub Function Not Supported - Invalid Format
21	Busy - repeat Request
22	Conditions Not Correct Or Request Sequence Error
23	Routine Not Complete Or Service In Progress
31	Request Out Of Range
33	Security Access Denied - security Access Requested
35	Invalid Key
36	Exceed Number Of Attempts
37	Required Time Delay Not Expired
40	Download Not Accepted
41	Improper Download Type
42	Can Not Download To Specified Address
43	Can Not Download Number Of Bytes Requested
50	Upload Not Accepted
51	Improper Upload Type
52	Can Not Upload From Specified Address
53	Can Not Upload Number Of Bytes Requested
71	Transfer Suspended
72	Transfer Aborted
74	Illegal Address In Block Transfer
75	Illegal Byte Count In Block Transfer
76	Illegal Block Trasnfer Type
77	Block Transfer Data Checksum Error
78	Request Correcty Rcvd - Rsp Pending
79	Incorrect Byte Count During Block Transfer
80	Service Not Supported In Active Diagnostic Mode
C1	Start Comms +ve response
C2	Stop Comms +ve response
C3	Access Timing Params +ve response
81-8F	Reserved
90-F9	Vehicle manufacturer specific
FA-FE	System supplier specific
FF	Reserved by document
<h2>Sample scan obtained of a SMART FOR TWO car</h2>
--wakeup
81 -&gt; e9 8f
--get capabilities
01 00 -&gt; b2 3f f8 11     capabilities service 1: 1 3 4 5 6 7 b v d e f 10 11 12 13 14 15 1c 20
01 20 -&gt; 80 00 00 00     capabilities service 1: 21
02 00 00 -&gt; 7e 38 00 00  capabilities service 2: 2 3 4 5 6 7 b c d
05 00 00 -&gt; 7f 05 11     capabilities service 5: none
06 00 -&gt; ff c0 80 00     capabilities service 6: 1 2 3 4 5 6 7 8 9 a 11
08 00 00 00 00 00 00 -&gt; 7f 08 11    capabilities service 8: none
09 00 -&gt; 01 30 00 00 00  ???? expected 4 byte response...
--get status
01 01 -&gt; 01 07 69 00     MIL light off, 1 dtc, ready, no 02monotoring
--get dtc's
03 -&gt; 07 02 00 00 00 00  dtc P0702
--scan sensors
01 03
01 04
01 05 -&gt; 3a  engine coolant temp = 18C (3a=58 dec - 40 dec)
01 06
01 07
01 0b
01 0c
01 0d
01 0e
01 0f
01 10
01 11
01 12
01 13 -&gt; 03   2 sensors
01 14
01 15
01 1c
01 20 -&gt; 80 00 00 00   (always same: capabilities 21-40)
01 21 -&gt; 00 37</pre>
		</div><!--entry -->
	</div><!-- .entry-container -->
	<div class="post-footer fix">
	<span class="author">
	Posted by <a href="http://blog.perquin.com/blog/author/hugo/">hugo</a> at 12:00 am</span>
			<span class="tags"></span>
	</div><!-- .post-footer -->
	</div><!--post -->
      </div><!-- content -->
    </div><!-- main col -->
<div id="sidebar-shell-1" class="sidebar-shell sidebar-shell-right">
<div class="dbx-group right boxed warea" id="sidebar">
		<!--widget start --><div id="recent-posts-3" class="dbx-box suf-widget widget_recent_entries"><h3 class="dbx-handle plain">Recent Posts</h3><div class="dbx-content">				<ul>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-usb-drive/" title="AR Drone USB Drive">AR Drone USB Drive</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-program-elf-replacement/" title="AR Drone program.elf Replacement">AR Drone program.elf Replacement</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-versions/" title="AR Drone Versions">AR Drone Versions</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-video/" title="AR Drone Video">AR Drone Video</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-gpio/" title="AR Drone GPIO">AR Drone GPIO</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-i2c/" title="AR Drone i2c">AR Drone i2c</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ar-drone-navboard/" title="AR Drone Navigation Board">AR Drone Navigation Board</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/ardrone-motor-controller/" title="AR Drone Motor Controller">AR Drone Motor Controller</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/opensense/" title="OpenSense">OpenSense</a>
						</li>
					<li>
				<a href="http://blog.perquin.com/blog/opensense-i2cmaster/" title="OpenSense I2cMaster">OpenSense I2cMaster</a>
						</li>
				</ul>
		</div></div><!--widget end --><!--widget start --><div id="categories-3" class="dbx-box suf-widget widget_categories"><h3 class="dbx-handle plain">Categories</h3><div class="dbx-content">		<ul>
	<li class="cat-item cat-item-6"><a href="http://blog.perquin.com/blog/category/ardrone/">AR.Drone Parrot</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.perquin.com/blog/category/roomba/">iRobot Roomba</a>
</li>
	<li class="cat-item cat-item-4 current-cat"><a href="http://blog.perquin.com/blog/category/odbii/">ODB II</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://blog.perquin.com/blog/category/opensense/">OpenSense</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://blog.perquin.com/blog/category/uncategorized/">Uncategorized</a>
</li>
		</ul>
</div></div><!--widget end --><!--widget start --><div id="archives-3" class="dbx-box suf-widget widget_archive"><h3 class="dbx-handle plain">Archives</h3><div class="dbx-content">		<ul>
			<li><a href="http://blog.perquin.com/blog/2012/09/" title="September 2012">September 2012</a></li>
	<li><a href="http://blog.perquin.com/blog/2011/09/" title="September 2011">September 2011</a></li>
	<li><a href="http://blog.perquin.com/blog/2011/07/" title="July 2011">July 2011</a></li>
	<li><a href="http://blog.perquin.com/blog/2011/06/" title="June 2011">June 2011</a></li>
	<li><a href="http://blog.perquin.com/blog/2006/01/" title="January 2006">January 2006</a></li>
	<li><a href="http://blog.perquin.com/blog/2005/05/" title="May 2005">May 2005</a></li>
	<li><a href="http://blog.perquin.com/blog/2005/01/" title="January 2005">January 2005</a></li>
	<li><a href="http://blog.perquin.com/blog/2004/11/" title="November 2004">November 2004</a></li>
	<li><a href="http://blog.perquin.com/blog/2004/10/" title="October 2004">October 2004</a></li>
	<li><a href="http://blog.perquin.com/blog/2001/10/" title="October 2001">October 2001</a></li>
		</ul>
</div></div><!--widget end --></div><!--/sidebar -->
</div>
	</div><!-- /container -->

	<div id="cred">
		<table>
			<tbody><tr>
				<td class="cred-left">© 2013 <a href="http://blog.perquin.com/">Tech Toy Hacks</a></td>
				<td class="cred-center"></td>
				<td class="cred-right"><a href="http://www.aquoid.com/news/themes/suffusion/">Suffusion theme by Sayontan Sinha</a></td>
			</tr>
		</tbody></table>
	</div>
		<!-- 37 queries, 30MB in 0.168 seconds. -->
	</div><!--/wrapper -->



</body></html>